name: Windows RustDesk Temporary Access

on:
  workflow_dispatch:

jobs:
  rustdesk-access:
    runs-on: windows-latest
    timeout-minutes: 360  # Max allowed by GitHub

    steps:
    - name: Download RustDesk
      run: |
        # Download from official source
        Invoke-WebRequest -Uri "https://github.com/rustdesk/rustdesk/releases/latest/download/rustdesk-windows_x64.zip" -OutFile rustdesk.zip
        Expand-Archive -Path rustdesk.zip -DestinationPath .\rustdesk

    - name: Start RustDesk
      run: Start-Process -FilePath ".\rustdesk\rustdesk.exe" -ArgumentList "--server"

    - name: Display Connection Info
      run: |
        # Wait for credentials to generate
        Start-Sleep -Seconds 30
        
        if (Test-Path ".\rustdesk\config\id.txt") {
            $ID = Get-Content ".\rustdesk\config\id.txt"
            $PW = if (Test-Path ".\rustdesk\config\password.txt") { 
                Get-Content ".\rustdesk\config\password.txt" 
            } else { "NOT_GENERATED" }
            
            echo "============================"
            echo "TEMPORARY RUSTDESK ACCESS"
            echo "ID: $ID"
            echo "Password: $PW"
            echo ""
            echo "Note: Will auto-terminate after 6 hours"
            echo "============================"
        }
        
        # Keep alive within allowed limits
        Start-Sleep -Seconds 21420  # 357 minutes (allows cleanup time)
