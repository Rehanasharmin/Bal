name: RustDesk Server Setup

on:
  workflow_dispatch:

jobs:
  rustdesk-server:
    runs-on: ubuntu-latest
    timeout-minutes: 360  # 6 hour max

    steps:
    - name: Install dependencies
      run: sudo apt update && sudo apt install -y wget unzip

    - name: Download and setup RustDesk
      run: |
        # Download and extract
        wget https://github.com/rustdesk/rustdesk-server/releases/latest/download/rustdesk-server-linux-amd64.zip
        unzip rustdesk-server-linux-amd64.zip -d rustdesk-server
        
        # Navigate to correct directory
        cd rustdesk-server/amd64
        
        # Set permissions
        chmod +x hbbr hbbs
        
        # Start services
        nohup ./hbbs -r 0.0.0.0 > hbbs.log 2>&1 &
        nohup ./hbbr > hbbr.log 2>&1 &
        sleep 5
        
        # Get connection info
        echo "SERVER_ID=$(grep 'ID' hbbs.log | awk '{print $5}')" >> $GITHUB_ENV

    - name: Display connection info
      run: |
        echo "=============================="
        echo "ğŸ–¥ï¸ RustDesk Server Ready"
        echo "ğŸ”‘ Server ID: ${{ env.SERVER_ID }}"
        echo "ğŸ”’ Password: Will generate on first connect"
        echo ""
        echo "Note: This is temporary (6 hour max)"
        echo "=============================="
        
        # Keep alive
        sleep 6h
